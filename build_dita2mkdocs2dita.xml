<?xml version="1.0" encoding="UTF-8"?>
<!--
  This file is part of the DITA ReadTheDocs project.
  See the accompanying LICENSE file for applicable licenses.
-->
<project name="fox.jason.mkdocs2dita">

	<scriptdef language="javascript" name="create-mkdocs-ditamap">
		<attribute name="file"/>
		<attribute name="dir"/>
<![CDATA[

var file = attributes.get("file");
var dir = attributes.get("dir");

var pluginDir =  project.getProperty("dita.plugin.fox.jason.readthedocs.dir");
eval( '' + org.apache.tools.ant.util.FileUtils.readFully(
		   new java.io.FileReader(pluginDir + '/resource/readthedocs.js' ) ) );

var yaml = ReadTheDocs.analyseYAML(file);
ReadTheDocs.rewriteAsDitamap(yaml, dir);

]]>
	</scriptdef>


	<target depends="build-init" name="mkdocs2dita.init">
		<!-- This defines the input file -->
		<dirname property="args.input.dir" file="${args.input}"/>
		<property name="mkdocs.file" value="${args.input.dir}/mkdocs.yml"/>
		<dita-ot-fail id="DOTA069F">
			<condition>
				<not>
					<available file="${mkdocs.file}" type="file"/>
				</not>
			</condition>
			<param name="1" value="${mkdocs.file}"/>
		</dita-ot-fail>
	</target>



	<target name="mkdocs2dita">
		<copy todir="${dita.output.dir}">
  			<fileset dir="${args.input.dir}/docs" excludes="mkdocs.yml"/>
		</copy>

		<create-mkdocs-ditamap file="${mkdocs.file}" dir="${dita.output.dir}"/>
		<fail/>
	</target>


	<!--
		Ant target executed to create a readthedocs file
	-->
	<target depends="mkdocs2dita.init, mkdocs2dita" name="dita2mkdocs2dita"/>
</project>